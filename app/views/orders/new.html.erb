<script type="text/javascript">
  var missing = [<%= raw @missing.to_json %>];
  var invalid = [<%= raw @invalid.to_json %>];
</script>
<div>
  <% if @missing.any? || @invalid.any? %>
    <div id="errors" class="well">
      <h5>Please fix the following errors and before continuing:</h5>
      <% @missing.each do |field| %>
        <div class="alert alert-error">
          <p><strong><%= field.capitalize %></strong> is missing</p>
        </div>
      <% end %>
      <% @invalid.each do |field| %>
        <div class="alert alert-error">
          <p><strong><%= field.capitalize %></strong> is not valid</p>
        </div>
      <% end %>  
    </div> 
  <% end %> 
    <%= form_tag orders_path, :method => :post, :id => "order-form", :class => "form-horizontal #{@missing.any? || @invalid.any? ? 'error' : ''}" do %>
      <header class="stripe order active">
        <span>1</span><h1>Service Selection</h1>
        <div class="img-shadow left"><%= image_tag("shadow-left.png") %></div>
        <div class="img-shadow right"><%= image_tag("shadow-right.png") %></div>
      </header>
      <fieldset class="main-content" id="options">
        <p>Please select your required services below:</p>
        <% @services.each do |service| %>
          <div class="checkout-service <%= "selected" if @options.has_key?(service.id.to_s) %>">
            <label class="checkbox">
              <input type="checkbox" class="service" data-base="<%= service.base_cost %>" data-can-checkout="<%= service.can_checkout %>" name="services[]" value="<%= service.id %>" <%= "checked" if @options.any? && @options.has_key?(service.id.to_s) %>> <%= service.name %>
            </label>  
            <div class="options well" style=<%= "display:none;" if !@options.has_key?(service.id.to_s) %>>
              <% service.service_options.each do |option| %> 
                <% if option.is_arbitrary %>
                  <label for="<%= option.id %>"><%= option.name %></label>
                  <!--<input type="text" id="<%= option.id %>" name="options[<%= service.id %>][<%= option.id %>]" value="" disabled>-->
                  <% placeholder = option.placeholder.blank? ? "" : option.placeholder %>
                  <textarea id="<%= option.id %>" name="options[<%= service.id %>][<%= option.id %>]" placeholder="<%= placeholder %>" <%= "disabled" if !@options.has_key?(service.id.to_s) %>><%= @options[service.id.to_s][option.id.to_s] if @options.any? && @options[service.id.to_s] %></textarea>
                <% else %>
                  <label for="<%= option.id %>"><%= option.name %></label>
                  <!--<%= select_tag("options[#{service.id}][#{option.id}]", options_from_collection_for_select(option.service_option_values, "id", "name"), :disabled => true) %>-->
                  <select name='<%= "options[#{service.id}][#{option.id}]" %>' <%= "disabled" if !@options.has_key?(service.id.to_s) %>>
                    <% option.service_option_values.each do |value| %>
                      <option value="<%= value.id %>" data-additional="<%= value.additional_cost %>" <%= "selected" if @options[service.id.to_s] && @options[service.id.to_s][option.id.to_s].eql?(value.id.to_s) %>><%= value.name %></option>
                    <% end %>
                  </select><br><br>
                <% end %>
              <% end %>
            </div>
          </div>     
        <% end %>
        <br>
        <div class="well">
          <div class="alert alert-info" style="display:none;">
            <strong>Please note:</strong>
            <p>You have selected a service that requires additional parts.</p>
            <p>The cost displayed represents the base cost of the service not including additional costs.</p>
            <p>Once the order is place we will be in contact with an actual price quote.</p>
          </div>          
          <strong>Cost:</strong> Â£<span id="total-cost">0.00</span>
        </div>        
        <a class="btn btn-primary next">next</a>
      </fieldset>
      <header class="stripe no-margin order">
        <span>2</span><h1>Customer Information</h1>
        <div class="img-shadow left"><%= image_tag("shadow-left.png") %></div>
        <div class="img-shadow right"><%= image_tag("shadow-right.png") %></div>
        <div class="img-shadow left top"><%= image_tag("shadow-top-left.png") %></div>
        <div class="img-shadow right top"><%= image_tag("shadow-top-right.png") %></div>
      </header>        
      <fieldset class="main-content" id="user">
        <p>Please fill out all of the fields below:</p>
        <div class="left">
          <div class="control-group">
            <label class="control-label" for="first-name">First Name</label>
            <div class="controls">
              <input type="text" id="first-name" name="first-name" value=<%= params["first-name"] %>>
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="last-name">Last Name</label>
            <div class="controls">
              <input type="text" id="last-name" name="last-name" value=<%= params["last-name"] %>>
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="email">Email</label>
            <div class="controls">
              <input type="text" id="email" name="email" value=<%= params["email"] %>>
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="telephone">Phone Number</label>
            <div class="controls">
              <input type="text" id="telephone" name="telephone" value=<%= params["telephone"] %>>
            </div>
          </div>
        </div>
        <div class="right">
          <div class="control-group">
            <label class="control-label" for="building">Building Number</label>
            <div class="controls">
              <input type="text" id="building" name="building" value=<%= params["building"] %>>
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="street">Street Name</label>
            <div class="controls">
              <input type="text" id="street" name="street" value=<%= params["street"] %>>
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="town">Town</label>
            <div class="controls">
              <input type="text" id="town" name="town" value=<%= params["town"] %>>
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="postcode">Postcode</label>
            <div class="controls">
              <input type="text" id="postcode" name="postcode" value=<%= params["postcode"] %>>
            </div>
          </div>
        </div>
        <div style="clear:both;"></div>
        <a class="btn back">back</a>
        <a class="btn btn-primary next">next</a>
      </fieldset>
      <header class="stripe no-margin order">
        <span>3</span><h1>Collection Arrangements</h1>
        <div class="img-shadow left"><%= image_tag("shadow-left.png") %></div>
        <div class="img-shadow right"><%= image_tag("shadow-right.png") %></div>
        <div class="img-shadow left top"><%= image_tag("shadow-top-left.png") %></div>
        <div class="img-shadow right top"><%= image_tag("shadow-top-right.png") %></div>        
      </header>      
      <fieldset class="main-content" id="collection">
        <p>Please select a convenient day for collection:</p>
        <div id="datepicker"></div>
        <input type="hidden" name="date"  id="date"/>
        <p>Please select a convenient time for collection:</p>
        <%= select_time(nil, :prefix => "time") %>
        <br><br>
        <a class="btn back">back</a>
        <a class="btn btn-primary next">next</a>        
      </fieldset>
      <header class="stripe no-margin order">
        <span>4</span><h1>Discount Code</h1>
        <div class="img-shadow left"><%= image_tag("shadow-left.png") %></div>
        <div class="img-shadow right"><%= image_tag("shadow-right.png") %></div>
        <div class="img-shadow left top"><%= image_tag("shadow-top-left.png") %></div>
        <div class="img-shadow right top"><%= image_tag("shadow-top-right.png") %></div>        
      </header>      
      <fieldset class="main-content" id="collection">
        <p>If you have a discount code, enter it here:</p>
        <input type="text" id="discount" name="discount">
        <br>
        <br>
        <a class="btn back">back</a>
        <a class="btn btn-primary next">next</a>        
      </fieldset>      
      <header class="stripe no-margin order">
        <span>5</span><h1>Payment Details</h1>
        <div class="img-shadow left"><%= image_tag("shadow-left.png") %></div>
        <div class="img-shadow right"><%= image_tag("shadow-right.png") %></div>
        <div class="img-shadow left top"><%= image_tag("shadow-top-left.png") %></div>
        <div class="img-shadow right top"><%= image_tag("shadow-top-right.png") %></div>        
      </header>        
      <fieldset class="main-content" id="payment">
        <p>Please fill out all of the fields below:</p>
        <div class="alert alert-info" style="display:none;">
          <strong>Please note:</strong>
          <p>You have selected a service that requires additional cost calculation, so you cannot pay right now.</p>
          <p>Complete the order and we will be in contact shortly with a price quote.</p>
        </div>
        <input type="text" name="card-num" placeholder="Credit Card Number" value=""><br>
        <input type="text" name="card-num" placeholder="Verification Code" value=""><br>
        <input type="text" name="card-num" placeholder="Expiry Date" value=""><br>
        <br>
        <a class="btn back">back</a>
        <%= submit_tag :summary, :class => "btn btn-primary" %>
        <p><small>You can review this order before it's final</small></p>
      </fieldset>
      <footer class="stripe no-margin">
        <div class="img-shadow left top"><%= image_tag("shadow-top-left.png") %></div>
        <div class="img-shadow right top"><%= image_tag("shadow-top-right.png") %></div>     
      </div>
    <% end %>
</div>